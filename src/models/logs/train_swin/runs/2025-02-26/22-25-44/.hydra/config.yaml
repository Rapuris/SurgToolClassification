task_name: train_swin
tags:
- landmark
train: true
test: false
compile: false
ckpt_path: null
seed: 12345
data:
  _target_: phelix.data.PelphixUniformDataModule
  data_dir: ${paths.pelphix_root}
  rob_dir: ${paths.rob_root}
  batch_size: 32
  num_workers: 16
  pin_memory: false
  image_size:
  - 224
  - 224
  fliph: false
  image_channels: 3
  keypoints: true
  exclude_pat: 18-1109
model:
  _target_: phelix.models.SwinTransformerModule
  num_classes: 6
  num_keypoints: 16
  swin_unet:
    _target_: phelix.models.components.UNet
    num_classes: ${add:${model.num_classes},${model.num_keypoints}}
    in_channels: 3
    depth: 5
    start_filts: 64
    up_mode: transpose
    merge_mode: concat
  optimizer:
    _target_: torch.optim.AdamW
    _partial_: true
    lr: 6.0e-05
    eps: 1.0e-08
    betas:
    - 0.9
    - 0.999
    weight_decay: 0.01
  scheduler:
    _target_: torch.optim.lr_scheduler.MultiStepLR
    _partial_: true
    milestones:
    - 100
    - 200
    gamma: 0.1
    last_epoch: -1
callbacks:
  model_checkpoint:
    _target_: lightning.pytorch.callbacks.ModelCheckpoint
    dirpath: ${paths.output_dir}/checkpoints
    filename: epoch_{epoch:03d}
    monitor: val/heatmap_loss
    verbose: false
    save_last: true
    save_top_k: 1
    mode: min
    auto_insert_metric_name: false
    save_weights_only: false
    every_n_train_steps: null
    train_time_interval: null
    every_n_epochs: null
    save_on_train_epoch_end: null
  model_summary:
    _target_: lightning.pytorch.callbacks.RichModelSummary
    max_depth: -1
  image_logger:
    _target_: phelix.callbacks.image_logger.ImageLogger
    batch_frequency: 500
    epoch_frequency: 1
    max_images: 10
    clamp: true
    log_train: true
logger:
  wandb:
    _target_: lightning.pytorch.loggers.wandb.WandbLogger
    save_dir: ${paths.output_dir}
    offline: false
    id: null
    anonymous: null
    project: phelix
    log_model: false
    prefix: ''
    group: swin
    tags: ${tags}
    job_type: ''
  aim:
    experiment: train_swin
trainer:
  _target_: lightning.pytorch.trainer.Trainer
  default_root_dir: ${paths.output_dir}
  min_epochs: 10
  max_epochs: 3000
  accelerator: gpu
  devices: 1
  check_val_every_n_epoch: 100
  deterministic: false
  gradient_clip_val: 0.5
paths:
  root_dir: .
  data_dir: /home/killeen/datasets/OneDrive/datasets/Pelphix
  log_dir: ${paths.root_dir}/logs/
  output_dir: ${hydra:runtime.output_dir}
  work_dir: ${hydra:runtime.cwd}
  pelphix_root: /nfs/centipede/sampath/synthDRR_resized_seg/
  rob_root: /nfs/centipede/sampath/Rob_X_rays/18-1109
  nmdid_root: /nfs/centipede/sampath/nifti
  pelvis_annotations_dir: /nfs/centipede/sampath/2023-03-12_pelvis-annotations_ssm
extras:
  ignore_warnings: false
  enforce_tags: true
  print_config: true
